<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>نظام جدول الحصص المتطور</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <style>
    :root {
      --primary: #4361ee;
      --primary-dark: #3a56d4;
      --secondary: #7209b7;
      --success: #4cc9f0;
      --warning: #f72585;
      --light: #f8f9fa;
      --dark: #212529;
      --gray: #6c757d;
      --border-radius: 12px;
      --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      --transition: all 0.3s ease;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      color: var(--dark);
      line-height: 1.6;
      padding: 20px;
      min-height: 100vh;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    header {
      text-align: center;
      margin-bottom: 30px;
      padding: 20px;
      background: white;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
    }

    h1 {
      color: var(--primary);
      margin-bottom: 10px;
      font-size: 2.2rem;
    }

    .subtitle {
      color: var(--gray);
      font-size: 1.1rem;
    }

    .app-container {
      display: grid;
      grid-template-columns: 1fr 2fr;
      gap: 20px;
    }

    @media (max-width: 992px) {
      .app-container {
        grid-template-columns: 1fr;
      }
    }

    .form-section {
      background: white;
      padding: 25px;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
    }

    .form-title {
      color: var(--primary);
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid var(--light);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--dark);
    }

    input, select {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid #e1e5ee;
      border-radius: var(--border-radius);
      font-size: 1rem;
      transition: var(--transition);
      background-color: white;
    }

    input:focus, select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
    }

    .time-group {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }

    .btn {
      padding: 12px 20px;
      border: none;
      border-radius: var(--border-radius);
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .btn-primary {
      background: var(--primary);
      color: white;
      width: 100%;
    }

    .btn-primary:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(67, 97, 238, 0.3);
    }

    .btn-secondary {
      background: var(--secondary);
      color: white;
    }

    .btn-secondary:hover {
      background: #6511a0;
    }

    .btn-warning {
      background: var(--warning);
      color: white;
    }

    .btn-warning:hover {
      background: #e11574;
    }

    .btn-success {
      background: var(--success);
      color: white;
    }

    .btn-success:hover {
      background: #3ab3d6;
    }

    .btn-outline {
      background: transparent;
      border: 2px solid var(--primary);
      color: var(--primary);
    }

    .btn-outline:hover {
      background: var(--primary);
      color: white;
    }

    .display-section {
      background: white;
      padding: 25px;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 15px;
    }

    .view-toggle {
      display: flex;
      background: var(--light);
      border-radius: var(--border-radius);
      padding: 5px;
    }

    .view-toggle button {
      padding: 8px 15px;
      border: none;
      background: transparent;
      border-radius: 8px;
      cursor: pointer;
      transition: var(--transition);
    }

    .view-toggle button.active {
      background: var(--primary);
      color: white;
    }

    .search-filter {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .search-box {
      position: relative;
      flex: 1;
      min-width: 200px;
    }

    .search-box input {
      padding-right: 40px;
    }

    .search-box i {
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--gray);
    }

    .filter-select {
      min-width: 150px;
    }

    .schedule-list {
      list-style: none;
    }

    .schedule-item {
      background: white;
      margin-bottom: 15px;
      padding: 20px;
      border-radius: var(--border-radius);
      border-left: 5px solid var(--primary);
      box-shadow: var(--shadow);
      transition: var(--transition);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .schedule-item:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
    }

    .schedule-info h3 {
      color: var(--primary);
      margin-bottom: 5px;
    }

    .schedule-details {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      margin-top: 10px;
    }

    .detail {
      display: flex;
      align-items: center;
      gap: 5px;
      color: var(--gray);
      font-size: 0.9rem;
    }

    .schedule-actions {
      display: flex;
      gap: 10px;
    }

    .schedule-actions button {
      padding: 8px 12px;
      font-size: 0.9rem;
    }

    .weekly-schedule {
      display: none;
      margin-top: 20px;
    }

    .weekly-grid {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 15px;
    }

    .day-column {
      background: var(--light);
      border-radius: var(--border-radius);
      overflow: hidden;
    }

    .day-header {
      background: var(--primary);
      color: white;
      padding: 15px;
      text-align: center;
      font-weight: 600;
    }

    .day-sessions {
      padding: 10px;
      min-height: 300px;
    }

    .session-card {
      background: white;
      padding: 12px;
      margin-bottom: 10px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
      border-left: 3px solid var(--success);
    }

    .session-card h4 {
      font-size: 0.95rem;
      margin-bottom: 5px;
    }

    .session-time {
      font-size: 0.8rem;
      color: var(--gray);
      display: flex;
      justify-content: space-between;
    }

    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: var(--gray);
    }

    .empty-state i {
      font-size: 3rem;
      margin-bottom: 15px;
      color: #dee2e6;
    }

    .alert {
      padding: 15px;
      border-radius: var(--border-radius);
      margin-bottom: 20px;
      display: none;
    }

    .alert-success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .alert-error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    .stats-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: white;
      padding: 20px;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      text-align: center;
    }

    .stat-card i {
      font-size: 2rem;
      color: var(--primary);
      margin-bottom: 10px;
    }

    .stat-number {
      font-size: 2rem;
      font-weight: 700;
      color: var(--primary);
    }

    .stat-label {
      color: var(--gray);
      font-size: 0.9rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1><i class="fas fa-calendar-alt"></i> نظام جدول الحصص المتطور</h1>
      <p class="subtitle">إدارة وتنظيم الحصص الدراسية بسهولة وكفاءة</p>
    </header>

    <div class="stats-cards">
      <div class="stat-card">
        <i class="fas fa-chalkboard-teacher"></i>
        <div class="stat-number" id="totalTeachers">0</div>
        <div class="stat-label">عدد المدرسين</div>
      </div>
      <div class="stat-card">
        <i class="fas fa-book"></i>
        <div class="stat-number" id="totalSubjects">0</div>
        <div class="stat-label">عدد المواد</div>
      </div>
      <div class="stat-card">
        <i class="fas fa-users"></i>
        <div class="stat-number" id="totalClasses">0</div>
        <div class="stat-label">عدد الشعب</div>
      </div>
      <div class="stat-card">
        <i class="fas fa-clock"></i>
        <div class="stat-number" id="totalSessions">0</div>
        <div class="stat-label">إجمالي الحصص</div>
      </div>
    </div>

    <div class="app-container">
      <section class="form-section">
        <h2 class="form-title"><i class="fas fa-plus-circle"></i> إضافة / تعديل حصة</h2>
        
        <div class="alert alert-success" id="successAlert">
          <i class="fas fa-check-circle"></i> تمت العملية بنجاح!
        </div>
        
        <div class="alert alert-error" id="errorAlert">
          <i class="fas fa-exclamation-circle"></i> حدث خطأ، يرجى المحاولة مرة أخرى.
        </div>
        
        <div class="form-group">
          <label for="teacherName"><i class="fas fa-user-tie"></i> اسم المدرس</label>
          <input type="text" id="teacherName" placeholder="أدخل اسم المدرس">
        </div>
        
        <div class="form-group">
          <label for="subject"><i class="fas fa-book"></i> المادة</label>
          <input type="text" id="subject" placeholder="أدخل اسم المادة">
        </div>
        
        <div class="form-group">
          <label for="className"><i class="fas fa-users"></i> الصف / الشعبة</label>
          <input type="text" id="className" placeholder="أدخل الصف أو الشعبة">
        </div>
        
        <div class="form-group">
          <label for="day"><i class="fas fa-calendar-day"></i> اليوم</label>
          <select id="day">
            <option value="الأحد">الأحد</option>
            <option value="الإثنين">الإثنين</option>
            <option value="الثلاثاء">الثلاثاء</option>
            <option value="الأربعاء">الأربعاء</option>
            <option value="الخميس">الخميس</option>
          </select>
        </div>
        
        <div class="form-group">
          <label><i class="fas fa-clock"></i> وقت الحصة</label>
          <div class="time-group">
            <div>
              <label for="startTime">وقت البدء</label>
              <input type="time" id="startTime">
            </div>
            <div>
              <label for="endTime">وقت الانتهاء</label>
              <input type="time" id="endTime">
            </div>
          </div>
        </div>
        
        <button class="btn btn-primary" onclick="addOrUpdateSchedule()">
          <i class="fas fa-save"></i> <span id="submitButtonText">إضافة الحصة</span>
        </button>
        
        <button class="btn btn-outline" onclick="clearForm()" style="margin-top: 10px; width: 100%;">
          <i class="fas fa-times"></i> إلغاء
        </button>
      </section>

      <section class="display-section">
        <div class="section-header">
          <h2><i class="fas fa-list"></i> الحصص الحالية</h2>
          
          <div class="view-toggle">
            <button class="active" onclick="toggleView('list')"><i class="fas fa-list"></i> قائمة</button>
            <button onclick="toggleView('weekly')"><i class="fas fa-calendar-week"></i> أسبوعي</button>
          </div>
          
          <div class="search-filter">
            <div class="search-box">
              <input type="text" id="searchInput" placeholder="بحث في الحصص...">
              <i class="fas fa-search"></i>
            </div>
            <select class="filter-select" id="dayFilter" onchange="filterSchedules()">
              <option value="">جميع الأيام</option>
              <option value="الأحد">الأحد</option>
              <option value="الإثنين">الإثنين</option>
              <option value="الثلاثاء">الثلاثاء</option>
              <option value="الأربعاء">الأربعاء</option>
              <option value="الخميس">الخميس</option>
            </select>
          </div>
        </div>
        
        <div id="listView">
          <ul class="schedule-list" id="scheduleList">
            <!-- سيتم ملؤها بالبيانات -->
          </ul>
        </div>
        
        <div class="weekly-schedule" id="weeklyView">
          <div class="weekly-grid" id="weeklyGrid">
            <!-- سيتم ملؤها بالبيانات -->
          </div>
        </div>
      </section>
    </div>
  </div>

  <script>
    // إعداد Firebase
    const firebaseConfig = {
  apiKey: "AIzaSyBoPJbx5v6EkOqxOJkbhzHqIJdAByh79Rg",
  authDomain: "hhhhhh-d4fb8.firebaseapp.com",
  databaseURL: "https://hhhhhh-d4fb8-default-rtdb.firebaseio.com",
  projectId: "hhhhhh-d4fb8",
  storageBucket: "hhhhhh-d4fb8.appspot.com",
  messagingSenderId: "24512338206",
  appId: "1:24512338206:web:dfe045db59bd3434a2110f",
  measurementId: "G-HD4R7GNQ5H"
};
    
    // تهيئة Firebase
    try {
      firebase.initializeApp(firebaseConfig);
    } catch (error) {
      console.log("Firebase already initialized");
    }
    
    const db = firebase.firestore();
    let editId = null; // لتخزين id الحصة عند التعديل
    let currentView = 'list'; // العرض الحالي (قائمة أو أسبوعي)

    // إضافة / تعديل حصة
    function addOrUpdateSchedule() {
      const teacherName = document.getElementById("teacherName").value.trim();
      const subject = document.getElementById("subject").value.trim();
      const className = document.getElementById("className").value.trim();
      const day = document.getElementById("day").value;
      const startTime = document.getElementById("startTime").value;
      const endTime = document.getElementById("endTime").value;

      if (!teacherName || !subject || !className || !startTime || !endTime) {
        showAlert('errorAlert', 'يرجى إكمال جميع البيانات المطلوبة');
        return;
      }

      if (startTime >= endTime) {
        showAlert('errorAlert', 'وقت البدء يجب أن يكون قبل وقت الانتهاء');
        return;
      }

      const data = { 
        teacherName, 
        subject, 
        className, 
        day, 
        startTime, 
        endTime, 
        createdAt: new Date() 
      };

      if (editId) {
        // تعديل
        db.collection("sessionsSchedule").doc(editId).set(data)
          .then(() => {
            showAlert('successAlert', 'تم تعديل الحصة بنجاح!');
            editId = null;
            clearForm();
            fetchSchedules();
          })
          .catch(err => {
            console.error("Error updating document: ", err);
            showAlert('errorAlert', 'حدث خطأ أثناء تعديل الحصة');
          });
      } else {
        // إضافة جديدة
        db.collection("sessionsSchedule").add(data)
          .then(() => {
            showAlert('successAlert', 'تم إضافة الحصة بنجاح!');
            clearForm();
            fetchSchedules();
          })
          .catch(err => {
            console.error("Error adding document: ", err);
            showAlert('errorAlert', 'حدث خطأ أثناء إضافة الحصة');
          });
      }
    }

    // عرض رسالة تنبيه
    function showAlert(alertId, message) {
      const alertElement = document.getElementById(alertId);
      alertElement.innerHTML = `<i class="fas ${alertId === 'successAlert' ? 'fa-check-circle' : 'fa-exclamation-circle'}"></i> ${message}`;
      alertElement.style.display = 'block';
      
      setTimeout(() => {
        alertElement.style.display = 'none';
      }, 4000);
    }

    // مسح النموذج
    function clearForm() {
      document.getElementById("teacherName").value = "";
      document.getElementById("subject").value = "";
      document.getElementById("className").value = "";
      document.getElementById("startTime").value = "";
      document.getElementById("endTime").value = "";
      document.getElementById("submitButtonText").textContent = "إضافة الحصة";
      editId = null;
    }

    // جلب الحصص وعرضها
    function fetchSchedules() {
      const list = document.getElementById("scheduleList");
      list.innerHTML = "";
      
      db.collection("sessionsSchedule").orderBy("createdAt").get().then((snapshot) => {
        if (snapshot.empty) {
          list.innerHTML = `
            <div class="empty-state">
              <i class="fas fa-calendar-plus"></i>
              <h3>لا توجد حصص مضافة</h3>
              <p>ابدأ بإضافة الحصص الأولى إلى جدولك</p>
            </div>
          `;
          updateStats(0, 0, 0, 0);
          updateWeeklyView([]);
          return;
        }
        
        const sessions = [];
        const teachers = new Set();
        const subjects = new Set();
        const classes = new Set();
        
        snapshot.forEach(doc => {
          const s = doc.data();
          sessions.push({id: doc.id, ...s});
          teachers.add(s.teacherName);
          subjects.add(s.subject);
          classes.add(s.className);
          
          const li = document.createElement("li");
          li.className = "schedule-item";
          
          li.innerHTML = `
            <div class="schedule-info">
              <h3>${s.subject} - ${s.className}</h3>
              <div class="schedule-details">
                <div class="detail">
                  <i class="fas fa-user-tie"></i>
                  <span>${s.teacherName}</span>
                </div>
                <div class="detail">
                  <i class="fas fa-calendar-day"></i>
                  <span>${s.day}</span>
                </div>
                <div class="detail">
                  <i class="fas fa-clock"></i>
                  <span>${formatTime(s.startTime)} - ${formatTime(s.endTime)}</span>
                </div>
              </div>
            </div>
            <div class="schedule-actions">
              <button class="btn btn-success" onclick="editSchedule('${doc.id}')">
                <i class="fas fa-edit"></i> تعديل
              </button>
              <button class="btn btn-warning" onclick="deleteSchedule('${doc.id}')">
                <i class="fas fa-trash"></i> حذف
              </button>
            </div>
          `;
          list.appendChild(li);
        });
        
        updateStats(snapshot.size, teachers.size, subjects.size, classes.size);
        updateWeeklyView(sessions);
        
        // تطبيق البحث والتصفية إذا كانا نشطين
        filterSchedules();
      }).catch(err => {
        console.error("Error getting documents: ", err);
        showAlert('errorAlert', 'حدث خطأ أثناء جلب البيانات');
      });
    }

    // تحديث الإحصائيات
    function updateStats(totalSessions, totalTeachers, totalSubjects, totalClasses) {
      document.getElementById("totalSessions").textContent = totalSessions;
      document.getElementById("totalTeachers").textContent = totalTeachers;
      document.getElementById("totalSubjects").textContent = totalSubjects;
      document.getElementById("totalClasses").textContent = totalClasses;
    }

    // تحديث العرض الأسبوعي
    function updateWeeklyView(sessions) {
      const weeklyGrid = document.getElementById("weeklyGrid");
      weeklyGrid.innerHTML = "";
      
      const days = ["الأحد", "الإثنين", "الثلاثاء", "الأربعاء", "الخميس"];
      
      days.forEach(day => {
        const dayColumn = document.createElement("div");
        dayColumn.className = "day-column";
        
        const dayHeader = document.createElement("div");
        dayHeader.className = "day-header";
        dayHeader.textContent = day;
        
        const daySessions = document.createElement("div");
        daySessions.className = "day-sessions";
        
        const daySessionsData = sessions.filter(s => s.day === day)
          .sort((a, b) => a.startTime.localeCompare(b.startTime));
        
        if (daySessionsData.length === 0) {
          daySessions.innerHTML = `
            <div class="empty-state" style="padding: 20px 10px;">
              <i class="fas fa-calendar-times"></i>
              <p>لا توجد حصص</p>
            </div>
          `;
        } else {
          daySessionsData.forEach(session => {
            const sessionCard = document.createElement("div");
            sessionCard.className = "session-card";
            sessionCard.innerHTML = `
              <h4>${session.subject}</h4>
              <p>${session.className}</p>
              <div class="session-time">
                <span>${formatTime(session.startTime)}</span>
                <span>${formatTime(session.endTime)}</span>
              </div>
              <p style="margin-top: 5px; font-size: 0.8rem;">${session.teacherName}</p>
            `;
            daySessions.appendChild(sessionCard);
          });
        }
        
        dayColumn.appendChild(dayHeader);
        dayColumn.appendChild(daySessions);
        weeklyGrid.appendChild(dayColumn);
      });
    }

    // تنسيق الوقت
    function formatTime(timeString) {
      if (!timeString) return '';
      const [hours, minutes] = timeString.split(':');
      return `${hours}:${minutes}`;
    }

    // تبديل العرض بين القائمة والأسبوعي
    function toggleView(view) {
      currentView = view;
      const listView = document.getElementById("listView");
      const weeklyView = document.getElementById("weeklyView");
      const viewButtons = document.querySelectorAll(".view-toggle button");
      
      viewButtons.forEach(btn => btn.classList.remove("active"));
      event.target.classList.add("active");
      
      if (view === 'list') {
        listView.style.display = 'block';
        weeklyView.style.display = 'none';
      } else {
        listView.style.display = 'none';
        weeklyView.style.display = 'block';
      }
    }

    // تصفية الحصص
    function filterSchedules() {
      const searchTerm = document.getElementById("searchInput").value.toLowerCase();
      const dayFilter = document.getElementById("dayFilter").value;
      const items = document.querySelectorAll(".schedule-item");
      
      items.forEach(item => {
        const text = item.textContent.toLowerCase();
        const day = item.querySelector(".schedule-details .detail:nth-child(2) span").textContent;
        
        const matchesSearch = text.includes(searchTerm);
        const matchesDay = !dayFilter || day === dayFilter;
        
        if (matchesSearch && matchesDay) {
          item.style.display = "flex";
        } else {
          item.style.display = "none";
        }
      });
    }

    // حذف الحصة
    function deleteSchedule(id) {
      if (!confirm("هل أنت متأكد من حذف هذه الحصة؟")) return;
      
      db.collection("sessionsSchedule").doc(id).delete()
        .then(() => {
          showAlert('successAlert', 'تم حذف الحصة بنجاح!');
          fetchSchedules();
        })
        .catch(err => {
          console.error("Error deleting document: ", err);
          showAlert('errorAlert', 'حدث خطأ أثناء حذف الحصة');
        });
    }

    // تعديل الحصة
    function editSchedule(id) {
      db.collection("sessionsSchedule").doc(id).get().then(doc => {
        if (!doc.exists) {
          showAlert('errorAlert', 'الحصة غير موجودة');
          return;
        }
        
        const s = doc.data();
        document.getElementById("teacherName").value = s.teacherName;
        document.getElementById("subject").value = s.subject;
        document.getElementById("className").value = s.className;
        document.getElementById("day").value = s.day;
        document.getElementById("startTime").value = s.startTime;
        document.getElementById("endTime").value = s.endTime;
        
        editId = id;
        document.getElementById("submitButtonText").textContent = "حفظ التعديل";
        
        // التمرير إلى نموذج الإضافة/التعديل
        document.querySelector(".form-section").scrollIntoView({ behavior: 'smooth' });
      }).catch(err => {
        console.error("Error getting document: ", err);
        showAlert('errorAlert', 'حدث خطأ أثناء تحميل بيانات الحصة');
      });
    }

    // تهيئة التطبيق
    document.addEventListener('DOMContentLoaded', function() {
      fetchSchedules();
      
      // إضافة مستمعات الأحداث للبحث والتصفية
      document.getElementById("searchInput").addEventListener("input", filterSchedules);
      document.getElementById("dayFilter").addEventListener("change", filterSchedules);
    });
  </script>
</body>
</html>
